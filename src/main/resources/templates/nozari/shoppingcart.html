<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>群岛服饰</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png"/>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Cormorant+Garamond:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="http://cdn.bootstrapmb.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/jquery-ui.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/chosen.min.css">
    <link rel="stylesheet" href="assets/css/pe-icon-7-stroke.css">
    <link rel="stylesheet" href="assets/css/magnific-popup.min.css">
    <link rel="stylesheet" href="assets/css/lightbox.min.css">
    <link rel="stylesheet" href="assets/js/fancybox/source/jquery.fancybox.css">
    <link rel="stylesheet" href="assets/css/jquery.scrollbar.min.css">
    <link rel="stylesheet" href="assets/css/mobile-menu.css">
    <link rel="stylesheet" href="assets/fonts/flaticon/flaticon.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="layui/css/layui.css" rel="stylesheet">
    <script type="text/javascript" src="layui/layui.js"></script>
    <script src="layui/layui.all.js"></script>
    <script type="text/javascript" src="js/jquery-3.5.1.min.js"></script>
    <script>
        var total = 0;
        $(function () {
            $(".productQuan").each(function () {
                var num = parseInt($(this).find(".qty").val());
                var price = parseInt($(this).parent().children().children().children(".woocommerce-Price-currencySymbol").text());
                total += num*price;
                $(".total-price").text(total);
            });

            $(".quantity-plus").each(function(i){
                $(this).attr('id','id1_'+i);
                $("#id1_"+i).click(function () {
                    var val = $(this).parent().parent().parent().parent().children().children(".layui-btn-sm").val();
                    $.ajax({
                        url:"/addQuantity?id="+val,
                        async:false,
                        success:function (data) {
                            if(data == "增加成功"){
                                console.log(val);
                            }
                        }
                    });
                });
                i++;
            });
            $(".qty").each(function(i){
                $(this).attr('id','qty_'+i);
            });
            $(".quantity-minus").each(function(i){
                $(this).attr('id','id2_'+i);
                $("#id2_"+i).click(function () {
                    var val = $(this).parent().parent().parent().parent().children().children(".layui-btn-sm").val();
                    $.ajax({
                        url:"/reduceQuantity?id="+val,
                        async:false,
                        success:function (data) {
                            if(data == "减少成功"){
                                console.log(val);
                            }else if(data =="删除服装"){
                                window.alert("服装删除了");
                                location.reload();
                            }
                        }
                    });
                    var goods_price = parseInt($(this).parent().parent().parent().parent().children().children().children(".woocommerce-Price-currencySymbol").text());
                    var num = $(".quantity-minus").parent().children("#qty_"+i).val();
                    if (num >= 1){
                        $(".total-price").text(parseInt($(".total-price").text())-goods_price);
                    }else if(num <= 0) {
                        $("#id2_"+i).attr("disabled","disabled");
                    }
                });
            });
            $(".quantity-plus").click(function () {
                var goods_price = parseInt($(this).parent().parent().parent().parent().children().children().children(".woocommerce-Price-currencySymbol").text());
                $(".total-price").text(parseInt($(".total-price").text())+goods_price);
            });
        });
    </script>
    <script>
        function xiadan() {
            $("#hiddenPrice").val($(".total-price").text());
            $("#accountForm").submit();
        }
    </script>
</head>
<body class="inblog-page">
<!--header-->
<header class="header style7" th:insert="~{nozari/hander::hander}">
</header>
<!--header-->
<div class="header-device-mobile">
    <div class="wapper">
        <div class="item mobile-logo">
            <div class="logo">
                <a href="#">
                    <img src="assets/images/logo.png" alt="img">
                </a>
            </div>
        </div>
        <div class="item item mobile-search-box has-sub">
            <a href="#">
						<span class="icon">
							<i class="fa fa-search" aria-hidden="true"></i>
						</span>
            </a>
            <div class="block-sub">
                <a href="#" class="close">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </a>
                <div class="header-searchform-box">
                    <form class="header-searchform">
                        <div class="searchform-wrap">
                            <input type="text" class="search-input" placeholder="Enter keywords to search...">
                            <input type="submit" class="submit button" value="Search">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="site-content">
    <main class="site-main  main-container no-sidebar">
        <div class="container">
            <div class="breadcrumb-trail breadcrumbs">
                <ul class="trail-items breadcrumb">
                    <li class="trail-item trail-begin">
                        <a href="/showClothes">
								<span>
									主页
								</span>
                        </a>
                    </li>
                    <li class="trail-item trail-end active">
							<span>
								购物车
							</span>
                    </li>
                </ul>
            </div>
            <div class="row">
                <div class="main-content-cart main-content col-sm-12">
                    <h3 class="custom_blog_title">
                        购物车
                    </h3>
                    <div class="page-main-content">
                        <div class="shoppingcart-content">
                            <form action="shoppingcart.html" class="cart-form">
                                <table class="shop_table">
                                    <thead>
                                    <tr>
                                        <th class="product-remove"></th>
                                        <th class="product-thumbnail"></th>
                                        <th class="product-name"></th>
                                        <th class="product-price"></th>
                                        <th class="product-quantity"></th>
                                        <th class="product-subtotal"></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr class="cart_item" th:each="cart :${Cart}">
                                        <td class="product-remove">
                                            <button type="button" th:value="${cart.id}" name="del" class="layui-btn layui-btn-primary layui-btn-sm"><i class="layui-icon"></i></button>
                                        </td>
                                        <td class="product-thumbnail">
                                            <a href="#">
                                                <img th:src="${cart.img_name}" alt="img"
                                                     class="attachment-shop_thumbnail size-shop_thumbnail wp-post-image">
                                            </a>
                                        </td>
                                        <td class="product-name" data-title="Product">
                                            <a href="#" class="title" th:text="${cart.name}"></a>
                                            <span class="attributes-select attributes-color" th:text="${cart.color}"></span>
                                            <span class="attributes-select attributes-size" th:text="${cart.size}"></span>
                                        </td>
                                        <td class="product-quantity productQuan" data-title="Quantity">
                                            <div class="quantity">
                                                <div class="control">
                                                    <a class="btn-number qtyminus quantity-minus" name="reduce" href="javascript:void(0)">-</a>
                                                    <input type="text" data-step="1" data-min="0" th:value="${cart.quantity}" title="Qty"
                                                           class="input-qty qty" size="4">
                                                    <a href="javascript:void(1)" class="btn-number qtyplus quantity-plus" name="plus">+</a>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="product-price productPri" data-title="Price">
													<span class="woocommerce-Price-amount amount">
                                                        ￥
														<span class="woocommerce-Price-currencySymbol" th:text="${cart.price}">

														</span>
													</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="actions">
                                            <div class="order-total">
														<span class="title">
															总价:￥
														</span>
                                                <span class="total-price">0</span>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </form>
                            <div class="control-cart">
                                <a th:href="@{/showClothes}">
                                <button class="button btn-continue-shopping">
                                    继续购物
                                </button>
                                </a>
                                <a href="javascript:;" id="xiadan" onclick="xiadan();">
                                    <form id="accountForm" action="becomeOrder" method="post" >
                                        <input type="hidden" name="orderPrice" id="hiddenPrice"/>
                                        <button class="button btn-cart-to-checkout">
                                            下单
                                        </button>
                                    </form>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
<!--footer-->
<footer class="footer style7" th:insert="~{nozari/footer::footer}">
</footer>
<a href="#" class="backtotop">
    <i class="pe-7s-angle-up"></i>
</a>
<!--footer-->
<script>
    $(":button[name='del']").click(function () {
        var val = $(this).val();
        console.log(val);
        layer.open({
            type: 1,
            content: '确定要删除吗',
            shadeClose:true,
            btn: ['确定', '取消'],
            btn1:function () {
                $.ajax({
                    url:"/deleteCart?id="+val,
                    success:function (data) {
                        if(data == "删除成功"){
                            window.alert(data);
                            location.reload();
                        }else {
                            window.alert("删除失败");
                        }

                    }
                });
            },
            btn2:function () {
                layer.closeAll();
            }

        });
    });
</script>
<!--<script>-->
<!--    $("[href='javascript:void(0)']").click(function () {-->
<!--        var val = $(this).parent().parent().parent().parent().children().children(".layui-btn-sm").val();-->
<!--        console.log(val);-->
<!--        $.ajax({-->
<!--            url:"/reduceQuantity?id="+val,-->
<!--            type:'get',-->
<!--            async:false,-->
<!--            contentType:'application/json',-->
<!--            dataType:'json',-->
<!--            success:function (data) {-->
<!--                if(data == "减少成功"){-->
<!--                    window.alert("添加成功");-->
<!--                }else {-->
<!--                    window.alert("添加失败")-->
<!--                }-->
<!--            }-->
<!--        });-->
<!--    });-->
<!--</script>-->
<script src="assets/js/jquery-1.12.4.min.js"></script>
<script src="assets/js/jquery.plugin-countdown.min.js"></script>
<script src="assets/js/jquery-countdown.min.js"></script>
<script src="http://cdn.bootstrapmb.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="assets/js/owl.carousel.min.js"></script>
<script src="assets/js/magnific-popup.min.js"></script>
<script src="assets/js/isotope.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src="assets/js/jquery-ui.min.js"></script>
<script src="assets/js/mobile-menu.js"></script>
<script src="assets/js/chosen.min.js"></script>
<script src="assets/js/slick.js"></script>
<script src="assets/js/jquery.elevateZoom.min.js"></script>
<script src="assets/js/jquery.actual.min.js"></script>
<script src="assets/js/fancybox/source/jquery.fancybox.js"></script>
<script src="assets/js/lightbox.min.js"></script>
<script src="assets/js/owl.thumbs.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src='http://ditu.google.cn/maps/api/js?key=AIzaSyC3nDHy1dARR-Pa_2jjPCjvsOR4bcILYsM'></script>
<script src="assets/js/frontend-plugin.js"></script>
</body>
</html>