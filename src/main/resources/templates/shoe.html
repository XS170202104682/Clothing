<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>群岛服饰</title>
    <link th:href="@{/layui/css/layui.css}" rel="stylesheet">
    <script th:src="@{/layui/layui.js}"></script>
    <script th:src="@{/js/jquery-3.5.1.min.js}"></script>
    <script type="text/html" id="img">
        <img src="/{{d.img_name}}"/>
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script>
        //JavaScript代码区域
        layui.use('element', function(){
            var element = layui.element;

        });
    </script>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">群岛服饰</div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item"><a th:href="@{/showClothes}">前端首页</a></li>
            <li class="layui-nav-item"><a th:href="@{/toClothes}">商品管理</a></li>
            <li class="layui-nav-item"><a th:href="@{/toCustomer}">用户</a></li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <img th:src="@{http://t.cn/RCzsdCq}" class="layui-nav-img">
                    <span sec:authentication="name"></span>
                </a>
                <dl class="layui-nav-child">
                    <dd><a th:href="@{/adminRegister}" sec:authorize="!isAuthenticated()">注册</a></dd>
                    <dd><a th:href="@{/adminLogin}" sec:authorize="!isAuthenticated()">登录</a></dd>
                    <dd><a th:href="@{/logout}" sec:authorize="isAuthenticated()">注销</a></dd>
                </dl>
            </li>
        </ul>
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree"  lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a class="" href="javascript:;">所有商品</a>
                    <dl class="layui-nav-child">
                        <dd><a th:href="@{/toClothes}">服装</a></dd>
                        <dd><a th:href="@{/toShoes}">鞋袜</a></dd>
                        <dd><a th:href="@{/toUnderWear}">内衣裤</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">订单管理</a>
                    <dl class="layui-nav-child">
                        <dd><a th:href="@{/toOrder}">列表一</a></dd>
                        <dd><a th:href="@{/toOrder}">列表一</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">用户管理</a>
                    <dl class="layui-nav-child">
                        <dd><a th:href="@{/toCustomer}">列表一</a></dd>
                        <dd><a th:href="@{/toCustomer}">列表一</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
    </div>

    <div class="layui-body">
        <!-- 内容主体区域 -->
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>鞋袜</legend>
        </fieldset>
        <div class="layui-btn-group" style="float: left">
            <a id="add" class="layui-btn" target="_blank">新增</a>
        </div>

        <div class="row">
            <div class="col-lg-2" style="float: right">
                <div class="input-group">
                    <input name="id" id="demoReload" type="text" class="form-control" placeholder="搜索">
                    <span class="input-group-btn"><div id="search" class="btn btn-default" data-type="reload">查询</div></span>
                </div><!-- /input-group -->
            </div><!-- /.col-lg-6 -->
        </div><!-- /.row -->


            <table id="demo" lay-filter="test"></table>


        <div class="layui-footer">
            <!-- 底部固定区域 -->
            © layui.com - 底部固定区域
        </div>
    </div>
</div>
<script>
    $(function () {
        $("#add").click(function () {
            layer.open({
                type: 2
                ,title:'新增'
                ,offset: 'auto' //居中
                ,area:['400px','600px']
                ,content: 'toAddShoes'
                ,btnAlign: 'c' //按钮居中
                ,shade: 0 //不显示遮罩
                ,end: function(){
                    location.reload();
                }
            });
        });
    });
</script>
<script>


    layui.use('table', function(){
        const table = layui.table;
        //第一个实例
        table.render({
            elem: '#demo'
            ,height: 530
            ,url: 'shoes' //数据接口
            ,page: true //开启分页
            ,id:'testReload'
            ,limit: 10
            ,limits: [3,5,10,15]
            ,method: 'post'
            ,cols: [
                [ //表头
                    {field: 'number', title: '编号', width:70, sort: true}
                    ,{field: 'name', title: '名称', width:160}
                    ,{field: 'size', title: '尺寸', width: 80}
                    ,{field: 'brand', title: '品牌', width:150}
                    ,{field: 'price', title: '价格', width: 100}
                    ,{field: 'color', title: '颜色', width: 100}
                    ,{field: 'type', title: '类别', width: 100}
                    ,{field: 'material', title: '材质', width: 100}
                    ,{field: 'quantity', title: '数量', width: 100, sort: true}
                    ,{field: 'img_name', title: '图片', width: 140, templet:'#img'}
                    ,{fixed: 'right',title:'操作', width:200, align:'center', toolbar: '#barDemo'}
                ]]
            ,parseData: function(res){
                console.log(res.data);
                return {
                    "code": res.code,
                    "msg": res.msg,
                    "count": res.count,
                    "data": res.data
                };
            }
        });

        var active = {
            reload: function() {
                var demoReload = window.document.getElementById('demoReload').value;
                //执行重载
                table.reload('testReload', {
                    method: 'get'
                    , page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    , where: {
                        // key: {
                        'name': demoReload
                        // }
                    }
                });
            }
        };

        $('#search').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });


        table.on('tool(test)', function(obj){
            const data = obj.data;
            const id = data.id;
            // console.log(data);
            // console.log(id);
            if(obj.event === 'del'){
                layer.confirm('确认删除', function(index){
                    // obj.del();
                    $.ajax({
                        url: "/deleteClothes?id="+id,
                        method: "POST",
                        success:function (data) {
                            if (data == "删除成功"){
                                window.alert(data);
                                location.reload();
                            }else{
                                window.alert("删除失败");
                            }

                        }
                    });
                    layer.close(index);
                });
            } else if(obj.event === 'edit'){
                layer.open({
                    type: 2
                    ,title:'编辑'
                    ,area:['400px','600px']
                    ,shadeClose:true
                    ,content: "/modifiedShoe?id="+id
                    ,anim:5
                    ,end:function () {
                        location.reload();
                    }
                });
            }
        });

    });
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
</body>
</html>